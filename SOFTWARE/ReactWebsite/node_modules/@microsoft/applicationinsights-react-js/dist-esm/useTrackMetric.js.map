{"version":3,"file":"useTrackMetric.js.map","sources":["useTrackMetric.js"],"sourcesContent":["import { useEffect, useRef } from \"react\";\r\nimport { dateNow } from \"@microsoft/applicationinsights-core-js\";\r\nfunction getEngagementTimeSeconds(trackedData) {\r\n    return ((dateNow() -\r\n        trackedData.firstActiveTimestamp -\r\n        trackedData.totalIdleTime -\r\n        trackedData.idleCount * trackedData.idleTimeout) /\r\n        1000);\r\n}\r\nvar useComponentTracking = function (reactPlugin, componentName) {\r\n    var tracking = useRef({\r\n        hookTimestamp: dateNow(),\r\n        firstActiveTimestamp: 0,\r\n        totalIdleTime: 0,\r\n        lastActiveTimestamp: 0,\r\n        idleStartTimestamp: 0,\r\n        idleCount: 0,\r\n        idleTimeout: 5000\r\n    });\r\n    var savedCallback = useRef();\r\n    var callback = function () {\r\n        var trackedData = tracking.current;\r\n        if (trackedData.lastActiveTimestamp > 0 &&\r\n            trackedData.idleStartTimestamp === 0 &&\r\n            dateNow() - trackedData.lastActiveTimestamp >= trackedData.idleTimeout) {\r\n            trackedData.idleStartTimestamp = dateNow();\r\n            trackedData.idleCount++;\r\n        }\r\n    };\r\n    var delay = 100;\r\n    savedCallback.current = callback;\r\n    // Set up the interval.\r\n    useEffect(function () {\r\n        var id = setInterval(savedCallback.current, delay);\r\n        return function () {\r\n            clearInterval(id);\r\n            var trackedData = tracking.current;\r\n            if (trackedData.hookTimestamp === 0) {\r\n                throw new Error(\"useAppInsights:unload hook: hookTimestamp is not initialized.\");\r\n            }\r\n            if (trackedData.firstActiveTimestamp === 0) {\r\n                return;\r\n            }\r\n            var engagementTime = getEngagementTimeSeconds(trackedData);\r\n            var metricData = {\r\n                average: engagementTime,\r\n                name: \"React Component Engaged Time (seconds)\",\r\n                sampleCount: 1\r\n            };\r\n            var additionalProperties = { \"Component Name\": componentName };\r\n            reactPlugin.trackMetric(metricData, additionalProperties);\r\n        };\r\n    }, []);\r\n    var trackActivity = function () {\r\n        var trackedData = tracking.current;\r\n        if (trackedData.firstActiveTimestamp === 0) {\r\n            trackedData.firstActiveTimestamp = dateNow();\r\n            trackedData.lastActiveTimestamp = trackedData.firstActiveTimestamp;\r\n        }\r\n        else {\r\n            trackedData.lastActiveTimestamp = dateNow();\r\n        }\r\n        if (trackedData.idleStartTimestamp > 0) {\r\n            var lastIdleTime = trackedData.lastActiveTimestamp - trackedData.idleStartTimestamp;\r\n            trackedData.totalIdleTime += lastIdleTime;\r\n            trackedData.idleStartTimestamp = 0;\r\n        }\r\n    };\r\n    return trackActivity;\r\n};\r\nexport default useComponentTracking;\r\n//# sourceMappingURL=useTrackMetric.js.map"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}